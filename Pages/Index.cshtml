@page
@model IndexModel
@{
    ViewData["Title"] = "Gestion des congés";
}

<h1>Demander un congé</h1>
@if (!string.IsNullOrEmpty(Model.CodeSuiviGenere))
{
    <div class="alert alert-success">
        Votre demande a été enregistrée.<br />
        <strong>Code de suivi :</strong> <span style="font-family:monospace">@Model.CodeSuiviGenere</span><br />
        Conservez ce code pour suivre ou modifier votre demande.
    </div>
}
<form method="post">
    <div class="mb-3">
        <label asp-for="NomEmploye" class="form-label">Nom de l'employé</label>
        <input asp-for="NomEmploye" class="form-control" />
        <span asp-validation-for="NomEmploye" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="PosteEmploye" class="form-label">Poste de l'employé</label>
        <input asp-for="PosteEmploye" class="form-control" />
        <span asp-validation-for="PosteEmploye" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="DateDebut" class="form-label">Date de début</label>
        <input asp-for="DateDebut" class="form-control" type="date" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
        <span asp-validation-for="DateDebut" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="DateFin" class="form-label">Date de fin</label>
        <input asp-for="DateFin" class="form-control" type="date" />
        <span asp-validation-for="DateFin" class="text-danger"></span>
    </div>
    <button type="submit" class="btn btn-primary">Demander</button>
</form>

<p class="mt-3">
    <a href="/Suivi" class="btn btn-outline-secondary">Suivre ou modifier ma demande</a>
</p>

<hr />

<h2>Liste des demandes de congés</h2>
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> 
    Cette liste affiche un aperçu des demandes de congés (dates et statuts uniquement). 
    Seuls les administrateurs peuvent voir les détails complets et gérer les demandes. 
    Les employés peuvent suivre et modifier leurs demandes via le code de suivi.
</div>

<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Date de début</th>
            <th>Date de fin</th>
            <th>Statut</th>
        </tr>
    </thead>
    <tbody>
    @if (Model.Conges != null && Model.Conges.Count > 0)
    {
        foreach (var conge in Model.Conges)
        {
            <tr>
                <td>@conge.DateDebut.ToString("dd/MM/yyyy")</td>
                <td>@conge.DateFin.ToString("dd/MM/yyyy")</td>
                <td>
                    @if (conge.Annule)
                    {
                        <span class="badge bg-secondary">Annulé</span>
                    }
                    else if (conge.Statut == StatutConge.EnAttente)
                    {
                        <span class="badge bg-warning">En attente</span>
                    }
                    else if (conge.Statut == StatutConge.Validee)
                    {
                        <span class="badge bg-success">Validé</span>
                    }
                    else if (conge.Statut == StatutConge.Refusee)
                    {
                        <span class="badge bg-danger">Refusé</span>
                    }
                </td>
            </tr>
        }
    }
    else
    {
        <tr><td colspan="3" class="text-center text-muted">Aucune demande de congé enregistrée.</td></tr>
    }
    </tbody>
</table>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
